From 182d8cb9d84c3d00cd436ba3c45a370fb3a8f91e Mon Sep 17 00:00:00 2001
From: Philippe Normand <pnormand@igalia.com>
Date: Mon, 15 Mar 2021 15:50:01 +0000
Subject: [PATCH xserver] EME: Fix KeySystem permission handling

---
 Source/WebKit/ChangeLog                  | 11 +++++++++++
 Source/WebKit/UIProcess/WebPageProxy.cpp |  2 +-
 2 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/Source/WebKit/UIProcess/WebPageProxy.cpp b/Source/WebKit/UIProcess/WebPageProxy.cpp
index 2d8fc38a305e..b91b6d7d1477 100644
--- a/Source/WebKit/UIProcess/WebPageProxy.cpp
+++ b/Source/WebKit/UIProcess/WebPageProxy.cpp
@@ -8224,7 +8224,7 @@ void WebPageProxy::clearUserMediaState()
 
 void WebPageProxy::requestMediaKeySystemPermissionForFrame(uint64_t mediaKeySystemID, FrameIdentifier frameID, const WebCore::SecurityOriginData& topLevelDocumentOriginData, const String& keySystem)
 {
-#if ENABLE(MEDIA_STREAM)
+#if ENABLE(ENCRYPTED_MEDIA)
     MESSAGE_CHECK(m_process, m_process->webFrame(frameID));
 
     auto origin = API::SecurityOrigin::create(topLevelDocumentOriginData.securityOrigin());
-- 
2.30.2

